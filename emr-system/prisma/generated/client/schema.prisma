generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "sqlite"
  url      = "file:./emr.db"
}

model Users {
  user_id       Int          @id @default(autoincrement())
  username      String       @unique
  full_name     String
  role          String
  password_hash String
  doctors       Doctors?
  AccessLogs    AccessLogs[]
}

model Patients {
  patient_id     Int              @id @default(autoincrement())
  full_name      String
  date_of_birth  DateTime
  gender         String
  phone_number   String           @unique
  address        String
  MedicalHistory MedicalHistory[]
  Cases          Cases[]
  LabOrders      LabOrders[]
}

model Doctors {
  doctor_id Int     @id @default(autoincrement())
  user_id   Int     @unique
  user      Users   @relation(fields: [user_id], references: [user_id])
  Cases     Cases[]
}

model Diseases {
  disease_id   Int         @id @default(autoincrement())
  disease_name String      @unique
  Diagnoses    Diagnoses[]
}

model MedicalHistory {
  history_id     Int      @id @default(autoincrement())
  patient_id     Int
  patient        Patients @relation(fields: [patient_id], references: [patient_id])
  condition      String
  diagnosis_date DateTime
}

model Cases {
  case_id    Int         @id @default(autoincrement())
  patient_id Int
  doctor_id  Int
  patient    Patients    @relation(fields: [patient_id], references: [patient_id])
  doctor     Doctors     @relation(fields: [doctor_id], references: [doctor_id])
  case_date  DateTime
  notes      String
  Diagnoses  Diagnoses[]
  LabOrders  LabOrders[]
}

model Diagnoses {
  diagnosis_id   Int      @id @default(autoincrement())
  case_id        Int
  disease_id     Int
  case           Cases    @relation(fields: [case_id], references: [case_id])
  disease        Diseases @relation(fields: [disease_id], references: [disease_id])
  diagnosis_date DateTime
}

model LabOrders {
  order_id   Int          @id @default(autoincrement())
  case_id    Int
  patient_id Int
  case       Cases        @relation(fields: [case_id], references: [case_id])
  patient    Patients     @relation(fields: [patient_id], references: [patient_id])
  order_date DateTime
  test_type  String
  LabResults LabResults[]
}

model LabResults {
  result_id   Int       @id @default(autoincrement())
  order_id    Int
  order       LabOrders @relation(fields: [order_id], references: [order_id])
  result_date DateTime
  result_data String
}

model AccessLogs {
  log_id      Int      @id @default(autoincrement())
  user_id     Int
  user        Users    @relation(fields: [user_id], references: [user_id])
  access_time DateTime
  action      String
}
